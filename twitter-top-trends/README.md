# TwitterHeronTrending

A Heron topology that does a continuous computation of the top N hahTags in terms of cardinality.
The top N computation is done in a completely scalable way!

## In general: Streaming top N
Problem: You have tuples of the form ["value", "count"] and you want the top N tuples based on count.

The simplest way to do this is by global grouping on the stream and maintaining a list in memory of the top N items. This approach does not scale!

A more efficient way is having **parallel** top N jobs across partitions of the stream, and then merge those top Ns together to get the global top N.

## About this topology

    builder.setSpout(spoutId, new TweetStreamSpout(), 1);
    builder.setBolt(counterId, new RollingHashCountBolt(60, 5), DEFAULT_PARALLELISM)
        .fieldsGrouping(spoutId, new Fields("tweet"));
    builder.setBolt(intermediateRankerId, new IntermediateHashRankingsBolt(TOP_N), DEFAULT_PARALLELISM)
        .fieldsGrouping(counterId, new Fields("obj"));
    builder.setBolt(totalRankerId, new TotalHashTrendRankingsBolt(TOP_N))
        .globalGrouping(intermediateRankerId);


This topology does the following:

1. Creates a new stream from the spout. The spout retrieves sample tweets from Twitter (filtering of topics can be applied)
2. Extracts HashTags from each of the status updates
3. The stream is then grouped by hashtag, and passed to RollingHashCountBolt.
4. **RollingHashCountBolt** creates a rolling count of how many times each hashtag has occurred for the specific time window. It then emits the results according to the emmit frequency (frequency and time window are both configurable).
5. **IntermediateHashRankingsBolt** is ranking the topN incoming hashTags by their count. It then emits a Rankings object. (topN is again here configurable)
6. Finally, **TotalHashTrendRankingsBolt** is used to merge intermediate Rankings generated by a number of IntermediateHashRankingsBolt instances into a consolidated ranking


## The spout

The spout, **TwitterStreamSpout**, uses Twitter4j to retrieve tweets from Twitter. A sample (around 1%) of all available tweets (status) are stored in a linked blocking queue. (For more information, see Class LinkedBlockingQueue.) Finally, items are pulled off the queue and emitted to the topology.


## The Bolts



## Get a twitter account

Use the following steps to register a new Twitter Application and obtain the consumer and access token information needed to read from Twitter.

1. Go to <a href="" target="_blank">https://apps.twitter.com/</a> and use the **Create new app** button. When filling in the form, leave **Callback URL** empty.

2. Once the app has been created, select the **Keys and Access Tokens** tab.

3. Copy the **Consumer Key** and **Consumer Secret** information.

4. At the bottom of the page, select **Create my access token** if no tokens exist. Once the tokens have been created, copy the **Access Token** and **Access Token Secret** information.

5. In the **TwitterSpoutTopology** project you previously cloned, open the **resources/twitter4j.properties** file, and add the information gathered in the previous steps and then save the file.


## References

Project heavily influenced by [storm-starter](https://github.com/apache/storm/tree/master/examples/storm-starter) project.

